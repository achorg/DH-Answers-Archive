<?
/*
Plugin Name: bb Topic Icons
Plugin URI: http://devt.caffeinatedbliss.com/bbpress/topic-icons
Description: Adds configurable icons next to topics based on their status
Author: Paul Hawke
Author URI: http://paul.caffeinatedbliss.com/
Version: 0.6
*/

/****************************************************************************
 *
 * Configure the following constants to fine-tune the CSS classes that are
 * generated, the icon filenames that are used, and the text used in the
 * legend (if you have one displayed).  Note: filenames are likely to be
 * taken away in a future version and replaced with the concept of "icon sets"
 * whose filenames are fixed, so dont get used to editing the filenames,
 * as this will break in future versions.
 *
 ****************************************************************************/

// css class for the unsorted list used in the legend display
define( LEGEND_CLASS, 'topic_icon_legend' );

// busy threshold - a topic with more posts than this is counted as "busy"
// for purposes of picking an icon.
define( BUSY_THRESHOLD, 15 );

// width of the images, in pixels
define( ICON_WIDTH, '20' );

// height of the images, in pixels
define( ICON_HEIGHT, '20' );

// the URL base for where to find the default icon set.
define( ICON_SET_URL_BASE, BB_PLUGIN_URL.'bb-topic-icons/icon-sets/' );

/****************************************************************************
 *
 * Shouldnt be much need to edit anything beyond this point - configuration
 * is all done via the constants (above) and through and admin area page in
 * bbPress at runtime.
 *
 ****************************************************************************/

require( 'bb-topic-icons-api.php' );
require( 'bb-topic-icons-admin.php' );
require( 'interface.status-interpreter.php' );
require( 'interface.status-renderer.php' );
require( 'class.default-status-interpreter.php' );
require( 'class.default-status-renderer.php' );

function topic_icons_legend() {
	$icon_set_name = topic_icons_get_active_icon_set();
	$icon_set_url = ICON_SET_URL_BASE . $icon_set_name;
	$statuses = get_active_status_interpreter()->getAllStatuses();
	$renderer = get_active_status_renderer();
	
	echo '<ul id="'.LEGEND_CLASS.'">';
	for ($i=0; $i < count($statuses); $i++) {
		$image = $renderer->renderStatus($statuses[$i]);
		$tooltip = $renderer->renderStatusTooltip($statuses[$i]);
		$exists = file_exists(dirname(__FILE__).'/icon-sets/'.$icon_set_name.'/'.$image);

		if (isset($image) && strlen($image) > 0 &&
			isset($tooltip) && strlen($tooltip) > 0 && $exists) {
			echo '<li><img src="'.$icon_set_url.'/'.$image.
				'" width="'.ICON_WIDTH.'" height="'.ICON_HEIGHT.
				'" align="absmiddle">&nbsp;'.$tooltip.'</li>';
		}
	}
	echo '</ul>';
}

function topic_icons_css() {
	echo "\n<style type=\"text/css\"><!--\n";
	require( 'bb-topic-icons.css' );
	echo "\n--></style>";
}

function topic_icons_label( $label ) {
	global $topic;
	
	if (bb_is_front() || bb_is_forum() || bb_is_view() || bb_is_tag()) {		
		$icon_set_name = topic_icons_get_active_icon_set();
		$icon_set_url = ICON_SET_URL_BASE . $icon_set_name;

		$status = get_active_status_interpreter()->getStatus(bb_get_location(), $topic);
		$renderer = get_active_status_renderer();
		$image = $renderer->renderStatus($status);
		$tooltip = $renderer->renderStatusTooltip($status);
		$exists = file_exists(dirname(__FILE__).'/icon-sets/'.$icon_set_name.'/'.$image);

		if (!$exists) {
			return sprintf(__('<div class="topic-icon-image"><a href="%s"><img src="%s" width="%s" height="%s" alt="%s" border="0"></a></div> %s'), 
				get_topic_link($topic->topic_id), ICON_SET_URL_BASE.'/empty.png', ICON_WIDTH, ICON_HEIGHT, $tooltip, $label);
		} else if (strlen($tooltip) > 0) {		
			return sprintf(__('<div class="topic-icon-image"><a href="%s"><img src="%s" width="%s" height="%s" alt="%s" border="0"><span>%s</span></a></div> %s'), 
				get_topic_link($topic->topic_id), $icon_set_url.'/'.$image, ICON_WIDTH, ICON_HEIGHT, $tooltip, $tooltip, $label);
		} else {
			return sprintf(__('<div class="topic-icon-image"><a href="%s"><img src="%s" width="%s" height="%s" alt="%s" border="0"></a></div> %s'), 
				get_topic_link($topic->topic_id), $icon_set_url.'/'.$image, ICON_WIDTH, ICON_HEIGHT, $tooltip, $label);
		}
	}
	
	return $label;
}

function topic_icons_init( ) {
	remove_filter('bb_topic_labels', 'bb_closed_label', 10);
	remove_filter('bb_topic_labels', 'bb_sticky_label', 20);

	add_filter('bb_topic_labels', 'topic_icons_label', 11);

	add_action('bb_head', 'topic_icons_css');

	add_action('bb_admin_menu_generator', 'topic_icons_admin_page_add');
	add_action('bb_admin-header.php', 'topic_icons_admin_page_process');
	
	topic_icons_register_status_interpreter('default', new DefaultStatusInterpreter(BUSY_THRESHOLD));
	topic_icons_register_status_renderer('default', new DefaultStatusRenderer());
}

topic_icons_init();

?>
<?xml version="1.0" encoding="UTF-8"?>
<!-- generator="bbPress/1.0.2" -->
<rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom">
	<channel>
		<title>Digital Humanities Questions &#38; Answers &#187; Topic: Reasonable goals for a first DH project?</title>
		<link>http://digitalhumanities.org/answers/topic/reasonable-goals-for-a-first-dh-project</link>
		<description>Digital Humanities Questions &amp; Answers &#187; Topic: Reasonable goals for a first DH project?</description>
		<language>en-US</language>
		<pubDate>Sun, 24 Mar 2019 17:08:09 +0000</pubDate>
		<generator>http://bbpress.org/?v=1.0.2</generator>
		<textInput>
			<title><![CDATA[Search]]></title>
			<description><![CDATA[Search all topics from these forums.]]></description>
			<name>q</name>
			<link>http://digitalhumanities.org/answers/search.php</link>
		</textInput>
		<atom:link href="http://digitalhumanities.org/answers/rss/topic/reasonable-goals-for-a-first-dh-project" rel="self" type="application/rss+xml" />

		<item>
			 
				<title>gscottrobinson on "Reasonable goals for a first DH project?"</title>
						<link>http://digitalhumanities.org/answers/topic/reasonable-goals-for-a-first-dh-project#post-2389</link>
			<pubDate>Fri, 15 Apr 2016 14:05:14 +0000</pubDate>
			<dc:creator>gscottrobinson</dc:creator>
			<guid isPermaLink="false">2389@http://digitalhumanities.org/answers/</guid>
			<description>&#60;p&#62;Thank you so much, Patrick. The advice is appreciated. I've managed to download several years of the text, but the OCR is pretty terrible. Also, I've read a bit about topic modeling, but I'll look into it a bit more.&#60;/p&#62;
&#60;p&#62;Gregory
&#60;/p&#62;</description>
		</item>
		<item>
			 
				<title>Patrick Murray-John on "Reasonable goals for a first DH project?"</title>
						<link>http://digitalhumanities.org/answers/topic/reasonable-goals-for-a-first-dh-project#post-2388</link>
			<pubDate>Mon, 11 Apr 2016 19:06:31 +0000</pubDate>
			<dc:creator>Patrick Murray-John</dc:creator>
			<guid isPermaLink="false">2388@http://digitalhumanities.org/answers/</guid>
			<description>&#60;p&#62;Goals and scope for the project might depend on the difficulty of the part of the project that's implicit in all your questions -- getting OCR'd text or some other electronic form out of the articles. A quick look at their site makes it look expensive, and some publishers get squeemish, at least, about this kind of project.&#60;/p&#62;
&#60;p&#62;Depending on how you can get reasonably in machine-readable form, you might have to limit the scope to only one issue a year, or to a smaller date range, or both. That might make the 4th question a bit more feasible than the others.&#60;/p&#62;
&#60;p&#62;On the other hand, if you can get everything, the 1st question sounds like a good topic modeling project.&#60;/p&#62;
&#60;p&#62;Getting cited texts sounds pretty hard, or at least labor intensive. It would be difficult to parse out citations from the plain text. However, if you can't get plain text and only have images to work from, then that sounds like the most feasible question to pursue after you do that labor intensive work of collecting the data.
&#60;/p&#62;</description>
		</item>
		<item>
			 
				<title>gscottrobinson on "Reasonable goals for a first DH project?"</title>
						<link>http://digitalhumanities.org/answers/topic/reasonable-goals-for-a-first-dh-project#post-2387</link>
			<pubDate>Mon, 11 Apr 2016 17:56:35 +0000</pubDate>
			<dc:creator>gscottrobinson</dc:creator>
			<guid isPermaLink="false">2387@http://digitalhumanities.org/answers/</guid>
			<description>&#60;p&#62;Hi!&#60;/p&#62;
&#60;p&#62;I'm interested in learning more about computer-based textual analysis, so I developed a project using the journal Literature/Film Quarterly (LFQ). I haven't done this sort of research before, so I'm trying to determine the best questions to ask and the tools that will help me answer them. I'm hoping someone might be able to tell me if these are reasonable questions to ask. I'd also appreciate any suggestions. &#60;/p&#62;
&#60;p&#62;LFQ began in 1973 and continues now. As the oldest journal in the field, looking at the text should be able to provide some insights about how adaptation studies developed.  At about 50 articles a year for 43 years, I'm looking at 2150 articles.&#60;/p&#62;
&#60;p&#62;Questions: &#60;/p&#62;
&#60;p&#62;Can an examination of the entire text of LFQ reveal anything substantial about the way adaptation studies has changed from 1973-present?&#60;br /&#62;
What are the most frequently cited texts in each year? WebofScience doesn't support this journal.&#60;br /&#62;
What names (other scholars) appear most frequently each year?&#60;br /&#62;
What kinds of terms are used in earlier years (e.g. “fidelity,” &#34;intertextuality&#34;) and do they continue throughout the journal’s history?&#60;/p&#62;
&#60;p&#62;If there are other questions that I could explore, I'd appreciate any suggestions.
&#60;/p&#62;</description>
		</item>

	</channel>
</rss>

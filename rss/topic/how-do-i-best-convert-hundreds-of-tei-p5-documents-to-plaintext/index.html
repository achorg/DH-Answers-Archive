<?
/*
Plugin Name: bb Topic Icons
Plugin URI: http://devt.caffeinatedbliss.com/bbpress/topic-icons
Description: Adds configurable icons next to topics based on their status
Author: Paul Hawke
Author URI: http://paul.caffeinatedbliss.com/
Version: 0.6
*/

/****************************************************************************
 *
 * Configure the following constants to fine-tune the CSS classes that are
 * generated, the icon filenames that are used, and the text used in the
 * legend (if you have one displayed).  Note: filenames are likely to be
 * taken away in a future version and replaced with the concept of "icon sets"
 * whose filenames are fixed, so dont get used to editing the filenames,
 * as this will break in future versions.
 *
 ****************************************************************************/

// css class for the unsorted list used in the legend display
define( LEGEND_CLASS, 'topic_icon_legend' );

// busy threshold - a topic with more posts than this is counted as "busy"
// for purposes of picking an icon.
define( BUSY_THRESHOLD, 15 );

// width of the images, in pixels
define( ICON_WIDTH, '20' );

// height of the images, in pixels
define( ICON_HEIGHT, '20' );

// the URL base for where to find the default icon set.
define( ICON_SET_URL_BASE, BB_PLUGIN_URL.'bb-topic-icons/icon-sets/' );

/****************************************************************************
 *
 * Shouldnt be much need to edit anything beyond this point - configuration
 * is all done via the constants (above) and through and admin area page in
 * bbPress at runtime.
 *
 ****************************************************************************/

require( 'bb-topic-icons-api.php' );
require( 'bb-topic-icons-admin.php' );
require( 'interface.status-interpreter.php' );
require( 'interface.status-renderer.php' );
require( 'class.default-status-interpreter.php' );
require( 'class.default-status-renderer.php' );

function topic_icons_legend() {
	$icon_set_name = topic_icons_get_active_icon_set();
	$icon_set_url = ICON_SET_URL_BASE . $icon_set_name;
	$statuses = get_active_status_interpreter()->getAllStatuses();
	$renderer = get_active_status_renderer();
	
	echo '<ul id="'.LEGEND_CLASS.'">';
	for ($i=0; $i < count($statuses); $i++) {
		$image = $renderer->renderStatus($statuses[$i]);
		$tooltip = $renderer->renderStatusTooltip($statuses[$i]);
		$exists = file_exists(dirname(__FILE__).'/icon-sets/'.$icon_set_name.'/'.$image);

		if (isset($image) && strlen($image) > 0 &&
			isset($tooltip) && strlen($tooltip) > 0 && $exists) {
			echo '<li><img src="'.$icon_set_url.'/'.$image.
				'" width="'.ICON_WIDTH.'" height="'.ICON_HEIGHT.
				'" align="absmiddle">&nbsp;'.$tooltip.'</li>';
		}
	}
	echo '</ul>';
}

function topic_icons_css() {
	echo "\n<style type=\"text/css\"><!--\n";
	require( 'bb-topic-icons.css' );
	echo "\n--></style>";
}

function topic_icons_label( $label ) {
	global $topic;
	
	if (bb_is_front() || bb_is_forum() || bb_is_view() || bb_is_tag()) {		
		$icon_set_name = topic_icons_get_active_icon_set();
		$icon_set_url = ICON_SET_URL_BASE . $icon_set_name;

		$status = get_active_status_interpreter()->getStatus(bb_get_location(), $topic);
		$renderer = get_active_status_renderer();
		$image = $renderer->renderStatus($status);
		$tooltip = $renderer->renderStatusTooltip($status);
		$exists = file_exists(dirname(__FILE__).'/icon-sets/'.$icon_set_name.'/'.$image);

		if (!$exists) {
			return sprintf(__('<div class="topic-icon-image"><a href="%s"><img src="%s" width="%s" height="%s" alt="%s" border="0"></a></div> %s'), 
				get_topic_link($topic->topic_id), ICON_SET_URL_BASE.'/empty.png', ICON_WIDTH, ICON_HEIGHT, $tooltip, $label);
		} else if (strlen($tooltip) > 0) {		
			return sprintf(__('<div class="topic-icon-image"><a href="%s"><img src="%s" width="%s" height="%s" alt="%s" border="0"><span>%s</span></a></div> %s'), 
				get_topic_link($topic->topic_id), $icon_set_url.'/'.$image, ICON_WIDTH, ICON_HEIGHT, $tooltip, $tooltip, $label);
		} else {
			return sprintf(__('<div class="topic-icon-image"><a href="%s"><img src="%s" width="%s" height="%s" alt="%s" border="0"></a></div> %s'), 
				get_topic_link($topic->topic_id), $icon_set_url.'/'.$image, ICON_WIDTH, ICON_HEIGHT, $tooltip, $label);
		}
	}
	
	return $label;
}

function topic_icons_init( ) {
	remove_filter('bb_topic_labels', 'bb_closed_label', 10);
	remove_filter('bb_topic_labels', 'bb_sticky_label', 20);

	add_filter('bb_topic_labels', 'topic_icons_label', 11);

	add_action('bb_head', 'topic_icons_css');

	add_action('bb_admin_menu_generator', 'topic_icons_admin_page_add');
	add_action('bb_admin-header.php', 'topic_icons_admin_page_process');
	
	topic_icons_register_status_interpreter('default', new DefaultStatusInterpreter(BUSY_THRESHOLD));
	topic_icons_register_status_renderer('default', new DefaultStatusRenderer());
}

topic_icons_init();

?>
<?xml version="1.0" encoding="UTF-8"?>
<!-- generator="bbPress/1.0.2" -->
<rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom">
	<channel>
		<title>Digital Humanities Questions &#38; Answers &#187; Topic: How do I best convert hundreds of TEI P5 documents to plaintext?</title>
		<link>http://digitalhumanities.org/answers/topic/how-do-i-best-convert-hundreds-of-tei-p5-documents-to-plaintext</link>
		<description>Digital Humanities Questions &amp; Answers &#187; Topic: How do I best convert hundreds of TEI P5 documents to plaintext?</description>
		<language>en-US</language>
		<pubDate>Sun, 24 Mar 2019 17:08:10 +0000</pubDate>
		<generator>http://bbpress.org/?v=1.0.2</generator>
		<textInput>
			<title><![CDATA[Search]]></title>
			<description><![CDATA[Search all topics from these forums.]]></description>
			<name>q</name>
			<link>http://digitalhumanities.org/answers/search.php</link>
		</textInput>
		<atom:link href="http://digitalhumanities.org/answers/rss/topic/how-do-i-best-convert-hundreds-of-tei-p5-documents-to-plaintext" rel="self" type="application/rss+xml" />

		<item>
			 
				<title>acrymble on "How do I best convert hundreds of TEI P5 documents to plaintext?"</title>
						<link>http://digitalhumanities.org/answers/topic/how-do-i-best-convert-hundreds-of-tei-p5-documents-to-plaintext#post-2408</link>
			<pubDate>Sat, 11 Mar 2017 11:17:39 +0000</pubDate>
			<dc:creator>acrymble</dc:creator>
			<guid isPermaLink="false">2408@http://digitalhumanities.org/answers/</guid>
			<description>&#60;p&#62;There is a good tutorial on XSLT on the Programming Historian if you'd like to learn more.&#60;/p&#62;
&#60;p&#62;&#60;a href=&#34;http://programminghistorian.org/lessons/transforming-xml-with-xsl&#34; rel=&#34;nofollow&#34;&#62;http://programminghistorian.org/lessons/transforming-xml-with-xsl&#60;/a&#62;
&#60;/p&#62;</description>
		</item>
		<item>
			 
				<title>scottkleinman on "How do I best convert hundreds of TEI P5 documents to plaintext?"</title>
						<link>http://digitalhumanities.org/answers/topic/how-do-i-best-convert-hundreds-of-tei-p5-documents-to-plaintext#post-2407</link>
			<pubDate>Tue, 31 Jan 2017 19:52:22 +0000</pubDate>
			<dc:creator>scottkleinman</dc:creator>
			<guid isPermaLink="false">2407@http://digitalhumanities.org/answers/</guid>
			<description>&#60;p&#62;I just saw that this topic had been revived, and I thought I'd point out that &#60;a href=&#34;http://lexos.wheatoncollege.edu/&#34;&#62;Lexos&#60;/a&#62; enables the user to strip tags selectively customising how each tag is handled. This can be really useful if, for example, you want to keep readings in &#60;code&#62;&#38;lt;orig&#38;gt;&#60;/code&#62; and delete readings in &#60;code&#62;&#38;lt;reg&#38;gt;&#60;/code&#62;. We haven't tested it with large numbers of files, but you can always do your processing in small batches if it gets too slow.
&#60;/p&#62;</description>
		</item>
		<item>
			 
				<title>Stéfan Sinclair on "How do I best convert hundreds of TEI P5 documents to plaintext?"</title>
						<link>http://digitalhumanities.org/answers/topic/how-do-i-best-convert-hundreds-of-tei-p5-documents-to-plaintext#post-2406</link>
			<pubDate>Tue, 06 Dec 2016 19:53:53 +0000</pubDate>
			<dc:creator>Stéfan Sinclair</dc:creator>
			<guid isPermaLink="false">2406@http://digitalhumanities.org/answers/</guid>
			<description>&#60;p&#62;This is an older post, so it's probably not worth offering many more solutions, but I want to mention that some simple document conversion, including TEI, is available through Voyant.&#60;/p&#62;
&#60;p&#62;You would create a Voyant corpus as usual (say a zip file with TEI documents):&#60;/p&#62;
&#60;p&#62;&#60;a href=&#34;http://voyant-tools.org/docs/#!/guide/corpuscreator&#34; rel=&#34;nofollow&#34;&#62;&#60;a href=&#34;http://voyant-tools.org/docs/#&#34; rel=&#34;nofollow&#34;&#62;http://voyant-tools.org/docs/#&#60;/a&#62;!/guide/corpuscreator&#60;/a&#62;&#60;/p&#62;
&#60;p&#62;And then you could use the Documents tool (middle tab in the lower left-hand panel of the default skin) to download the corpus in one or more formats (original, minimal HTML for Voyant, plain text):&#60;/p&#62;
&#60;p&#62;&#60;a href=&#34;http://voyant-tools.org/docs/#!/guide/documents&#34; rel=&#34;nofollow&#34;&#62;&#60;a href=&#34;http://voyant-tools.org/docs/#&#34; rel=&#34;nofollow&#34;&#62;http://voyant-tools.org/docs/#&#60;/a&#62;!/guide/documents&#60;/a&#62;
&#60;/p&#62;</description>
		</item>
		<item>
			 
				<title>Kevin Hawkins on "How do I best convert hundreds of TEI P5 documents to plaintext?"</title>
						<link>http://digitalhumanities.org/answers/topic/how-do-i-best-convert-hundreds-of-tei-p5-documents-to-plaintext#post-2405</link>
			<pubDate>Tue, 06 Dec 2016 01:21:13 +0000</pubDate>
			<dc:creator>Kevin Hawkins</dc:creator>
			<guid isPermaLink="false">2405@http://digitalhumanities.org/answers/</guid>
			<description>&#60;p&#62;I should have also noted that OxGarage ( &#60;a href=&#34;http://www.tei-c.org/oxgarage/&#34; rel=&#34;nofollow&#34;&#62;http://www.tei-c.org/oxgarage/&#60;/a&#62; ) allows conversion from P5 to &#34;plain text&#34;. This page explains how to get the sourcecode behind it: &#60;a href=&#34;http://wiki.tei-c.org/index.php/OxGarage&#34; rel=&#34;nofollow&#34;&#62;http://wiki.tei-c.org/index.php/OxGarage&#60;/a&#62; .
&#60;/p&#62;</description>
		</item>
		<item>
			 
				<title>Kevin Hawkins on "How do I best convert hundreds of TEI P5 documents to plaintext?"</title>
						<link>http://digitalhumanities.org/answers/topic/how-do-i-best-convert-hundreds-of-tei-p5-documents-to-plaintext#post-2404</link>
			<pubDate>Tue, 06 Dec 2016 01:16:02 +0000</pubDate>
			<dc:creator>Kevin Hawkins</dc:creator>
			<guid isPermaLink="false">2404@http://digitalhumanities.org/answers/</guid>
			<description>&#60;p&#62;I should have also noted that OxGarage ( &#60;a href=&#34;http://www.tei-c.org/oxgarage/&#34; rel=&#34;nofollow&#34;&#62;http://www.tei-c.org/oxgarage/&#60;/a&#62; ) allows conversion from P5 to &#34;plain text&#34;. This page explains how to get the sourcecode behind it: &#60;a href=&#34;http://wiki.tei-c.org/index.php/OxGarage&#34; rel=&#34;nofollow&#34;&#62;http://wiki.tei-c.org/index.php/OxGarage&#60;/a&#62; .
&#60;/p&#62;</description>
		</item>
		<item>
			 
				<title>Kevin Hawkins on "How do I best convert hundreds of TEI P5 documents to plaintext?"</title>
						<link>http://digitalhumanities.org/answers/topic/how-do-i-best-convert-hundreds-of-tei-p5-documents-to-plaintext#post-2232</link>
			<pubDate>Tue, 02 Sep 2014 15:05:14 +0000</pubDate>
			<dc:creator>Kevin Hawkins</dc:creator>
			<guid isPermaLink="false">2232@http://digitalhumanities.org/answers/</guid>
			<description>&#60;p&#62;Do keep in mind that the approach recommended here strips the markup away, leaving only the text in between the tags.  Since the TEI (and other document-based XML languages) generally leave the transcribed text inside tags (rather than as, say, the values of attributes), this approach will work quite well.  But also keep in mind that the TEI has intentionally given up on the naive assumption that if you strip away the markup, you get the exact text that appeared on the page.  For example, the TEI's&#60;br /&#62;
&#60;pre&#62;choice&#60;/pre&#62;
 element includes text between tags for more than one interpretation of what you see on the page, so these two strings will appear in the output of the above command sequences, one after the other, while the source document contained only one of these (though the encoder is unclear on which).&#60;/p&#62;
&#60;p&#62;So beware that things like will introduce errors in your OCR training.
&#60;/p&#62;</description>
		</item>
		<item>
			 
				<title>Arno Bosse on "How do I best convert hundreds of TEI P5 documents to plaintext?"</title>
						<link>http://digitalhumanities.org/answers/topic/how-do-i-best-convert-hundreds-of-tei-p5-documents-to-plaintext#post-2231</link>
			<pubDate>Thu, 28 Aug 2014 18:12:52 +0000</pubDate>
			<dc:creator>Arno Bosse</dc:creator>
			<guid isPermaLink="false">2231@http://digitalhumanities.org/answers/</guid>
			<description>&#60;p&#62;Thank you very much everyone for your help - both techniques worked equally well. I still need to swap some characters and remove line breaks from the processed texts but I can easily batch that in my text editor. Thanks again!
&#60;/p&#62;</description>
		</item>
		<item>
			 
				<title>Stéfan Sinclair on "How do I best convert hundreds of TEI P5 documents to plaintext?"</title>
						<link>http://digitalhumanities.org/answers/topic/how-do-i-best-convert-hundreds-of-tei-p5-documents-to-plaintext#post-2230</link>
			<pubDate>Thu, 28 Aug 2014 16:52:47 +0000</pubDate>
			<dc:creator>Stéfan Sinclair</dc:creator>
			<guid isPermaLink="false">2230@http://digitalhumanities.org/answers/</guid>
			<description>&#60;p&#62;&#60;em&#62;Replying to @Hugh Cayless's &#60;a href=&#34;http://digitalhumanities.org/answers/topic/how-do-i-best-convert-hundreds-of-tei-p5-documents-to-plaintext#post-2229&#34;&#62;post&#60;/a&#62;:&#60;/em&#62;&#60;/p&#62;
&#60;p&#62;I was going to suggest something similar to Hugh, though the text() syntax doesn't seem to work when I test, but this does:&#60;/p&#62;
&#60;pre&#62;xmllint --xpath &#34;string(//*[local-name()='body'])&#34; FILENAME.xml&#60;/pre&#62;</description>
		</item>
		<item>
			 
				<title>Hugh Cayless on "How do I best convert hundreds of TEI P5 documents to plaintext?"</title>
						<link>http://digitalhumanities.org/answers/topic/how-do-i-best-convert-hundreds-of-tei-p5-documents-to-plaintext#post-2229</link>
			<pubDate>Thu, 28 Aug 2014 15:40:08 +0000</pubDate>
			<dc:creator>Hugh Cayless</dc:creator>
			<guid isPermaLink="false">2229@http://digitalhumanities.org/answers/</guid>
			<description>&#60;p&#62;&#60;em&#62;Replying to @Arno Bosse's &#60;a href=&#34;http://digitalhumanities.org/answers/topic/how-do-i-best-convert-hundreds-of-tei-p5-documents-to-plaintext#post-2227&#34;&#62;post&#60;/a&#62;:&#60;/em&#62;&#60;/p&#62;
&#60;p&#62;@&#60;a href='http://digitalhumanities.org/answers/profile/cforster'&#62;cforster&#60;/a&#62; is almost certainly right that you want an XSLT. It all depends on the level of encoding and whether you really want all of the text, laid out as it is in the document (maybe there are footnotes in the OCR for example that have been turned into inline notes in the TEI).&#60;/p&#62;
&#60;p&#62;That said, if you really just want a dead-simple text extraction, you can do something like the following with xmllint:&#60;/p&#62;
&#60;p&#62;&#60;code&#62;xmllint --xpath &#34;//*[local-name() ='text']//text()&#34; flle.xml&#60;/code&#62;&#60;/p&#62;
&#60;p&#62;That can be bundled up with a find command (or other method of iterating over the files) and the output redirected to files in order to do your batch processing.
&#60;/p&#62;</description>
		</item>
		<item>
			 
				<title>cforster on "How do I best convert hundreds of TEI P5 documents to plaintext?"</title>
						<link>http://digitalhumanities.org/answers/topic/how-do-i-best-convert-hundreds-of-tei-p5-documents-to-plaintext#post-2228</link>
			<pubDate>Thu, 28 Aug 2014 15:21:13 +0000</pubDate>
			<dc:creator>cforster</dc:creator>
			<guid isPermaLink="false">2228@http://digitalhumanities.org/answers/</guid>
			<description>&#60;p&#62;Well, &#60;em&#62;best&#60;/em&#62; is a tricky one. But if you're comfortable using XSLT this is pretty classic XSLT sort of problem. The default XSLT rules are to essentially output the content of the nodes so a &#60;em&#62;very&#60;/em&#62; simple script could do what you're looking to do (I've done it many times before). Chances are, though, that you are going to want to trip out the teiHeader and just get the body of the text. You can write an empty rule to match the teiHeader, which will have the effect of silencing its output. A simple (though imperfect may to do this would be an XSLT stylesheet something like the following:&#60;/p&#62;


&#60;div class=&#34;bb_syntax&#34;&#62;&#60;div class=&#34;code&#34;&#62;&#60;pre class=&#34;xslt&#34; style=&#34;font-family:monospace;&#34;&#62;&#38;lt;?xml version=&#38;quot;1.0&#38;quot; encoding=&#38;quot;utf-8&#38;quot;?&#38;gt;
&#38;nbsp;
&#38;lt;xsl:stylesheet xmlns:tei=&#38;quot;http://www.tei-c.org/ns/1.0&#38;quot;
  xmlns=&#38;quot;http://www.w3.org/1999/xhtml&#38;quot;
  xmlns:xsl=&#38;quot;http://www.w3.org/1999/XSL/Transform&#38;quot; version=&#38;quot;1.0&#38;quot;&#38;gt;
&#38;nbsp;
  &#38;lt;xsl:output method=&#38;quot;text&#38;quot; encoding=&#38;quot;UTF-8&#38;quot; /&#38;gt;
&#38;nbsp;
  &#38;lt;xsl:template match=&#38;quot;tei:TEI&#38;quot;&#38;gt;
    &#38;lt;xsl:apply-templates /&#38;gt;
  &#38;lt;/xsl:template&#38;gt;
&#38;nbsp;
  &#38;lt;xsl:template match=&#38;quot;tei:teiHeader&#38;quot;&#38;gt;&#38;lt;/xsl:template&#38;gt;
&#38;nbsp;
&#38;lt;/xsl:stylesheet&#38;gt;&#60;/pre&#62;&#60;/div&#62;&#60;/div&#62;



&#60;p&#62;If you're on OSX, the built-in xslt processor (xsltproc) can handle this. Just save the above XSLT code into a file (call it strip.xsl) and then, at the command line: &#60;code&#62;xsltproc strip.xsl [TEI FILE NAME]&#60;/code&#62;. By default this outputs to standard input (i.e. the screen), but you can pipe it into a file &#60;code&#62;xsltproc strip.xsl [TEI FILE NAME] &#38;gt; stripped.txt&#60;/code&#62;. And at this point if you can write a shell script, it should be possible to loop over all the files in a directory.
&#60;/p&#62;</description>
		</item>
		<item>
			 
				<title>Arno Bosse on "How do I best convert hundreds of TEI P5 documents to plaintext?"</title>
						<link>http://digitalhumanities.org/answers/topic/how-do-i-best-convert-hundreds-of-tei-p5-documents-to-plaintext#post-2227</link>
			<pubDate>Thu, 28 Aug 2014 14:47:32 +0000</pubDate>
			<dc:creator>Arno Bosse</dc:creator>
			<guid isPermaLink="false">2227@http://digitalhumanities.org/answers/</guid>
			<description>&#60;p&#62;I'd like to use the available corpora in the German Text Archive (&#60;a href=&#34;http://www.deutschestextarchiv.de/download&#34; rel=&#34;nofollow&#34;&#62;http://www.deutschestextarchiv.de/download&#60;/a&#62;) to train OCR software. For this I need these texts as plaintext. All the German Text Archive texts however are all TEI P5 tagged. How do I best convert these (hundreds..) of documents into plaintext? &#60;/p&#62;
&#60;p&#62;I'm comfortable on the command line and with small shell scripts but I wouldn't be able to write an app to make use of a public API to such a service. Ideally I'd like to find some tei2text-ish command line tool but the ones I've found in googling around and looking on GitHub don't appear (to me, leastways) to be suitable for TEI texts.
&#60;/p&#62;</description>
		</item>

	</channel>
</rss>

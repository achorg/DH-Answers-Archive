<?
/*
Plugin Name: bb Topic Icons
Plugin URI: http://devt.caffeinatedbliss.com/bbpress/topic-icons
Description: Adds configurable icons next to topics based on their status
Author: Paul Hawke
Author URI: http://paul.caffeinatedbliss.com/
Version: 0.6
*/

/****************************************************************************
 *
 * Configure the following constants to fine-tune the CSS classes that are
 * generated, the icon filenames that are used, and the text used in the
 * legend (if you have one displayed).  Note: filenames are likely to be
 * taken away in a future version and replaced with the concept of "icon sets"
 * whose filenames are fixed, so dont get used to editing the filenames,
 * as this will break in future versions.
 *
 ****************************************************************************/

// css class for the unsorted list used in the legend display
define( LEGEND_CLASS, 'topic_icon_legend' );

// busy threshold - a topic with more posts than this is counted as "busy"
// for purposes of picking an icon.
define( BUSY_THRESHOLD, 15 );

// width of the images, in pixels
define( ICON_WIDTH, '20' );

// height of the images, in pixels
define( ICON_HEIGHT, '20' );

// the URL base for where to find the default icon set.
define( ICON_SET_URL_BASE, BB_PLUGIN_URL.'bb-topic-icons/icon-sets/' );

/****************************************************************************
 *
 * Shouldnt be much need to edit anything beyond this point - configuration
 * is all done via the constants (above) and through and admin area page in
 * bbPress at runtime.
 *
 ****************************************************************************/

require( 'bb-topic-icons-api.php' );
require( 'bb-topic-icons-admin.php' );
require( 'interface.status-interpreter.php' );
require( 'interface.status-renderer.php' );
require( 'class.default-status-interpreter.php' );
require( 'class.default-status-renderer.php' );

function topic_icons_legend() {
	$icon_set_name = topic_icons_get_active_icon_set();
	$icon_set_url = ICON_SET_URL_BASE . $icon_set_name;
	$statuses = get_active_status_interpreter()->getAllStatuses();
	$renderer = get_active_status_renderer();
	
	echo '<ul id="'.LEGEND_CLASS.'">';
	for ($i=0; $i < count($statuses); $i++) {
		$image = $renderer->renderStatus($statuses[$i]);
		$tooltip = $renderer->renderStatusTooltip($statuses[$i]);
		$exists = file_exists(dirname(__FILE__).'/icon-sets/'.$icon_set_name.'/'.$image);

		if (isset($image) && strlen($image) > 0 &&
			isset($tooltip) && strlen($tooltip) > 0 && $exists) {
			echo '<li><img src="'.$icon_set_url.'/'.$image.
				'" width="'.ICON_WIDTH.'" height="'.ICON_HEIGHT.
				'" align="absmiddle">&nbsp;'.$tooltip.'</li>';
		}
	}
	echo '</ul>';
}

function topic_icons_css() {
	echo "\n<style type=\"text/css\"><!--\n";
	require( 'bb-topic-icons.css' );
	echo "\n--></style>";
}

function topic_icons_label( $label ) {
	global $topic;
	
	if (bb_is_front() || bb_is_forum() || bb_is_view() || bb_is_tag()) {		
		$icon_set_name = topic_icons_get_active_icon_set();
		$icon_set_url = ICON_SET_URL_BASE . $icon_set_name;

		$status = get_active_status_interpreter()->getStatus(bb_get_location(), $topic);
		$renderer = get_active_status_renderer();
		$image = $renderer->renderStatus($status);
		$tooltip = $renderer->renderStatusTooltip($status);
		$exists = file_exists(dirname(__FILE__).'/icon-sets/'.$icon_set_name.'/'.$image);

		if (!$exists) {
			return sprintf(__('<div class="topic-icon-image"><a href="%s"><img src="%s" width="%s" height="%s" alt="%s" border="0"></a></div> %s'), 
				get_topic_link($topic->topic_id), ICON_SET_URL_BASE.'/empty.png', ICON_WIDTH, ICON_HEIGHT, $tooltip, $label);
		} else if (strlen($tooltip) > 0) {		
			return sprintf(__('<div class="topic-icon-image"><a href="%s"><img src="%s" width="%s" height="%s" alt="%s" border="0"><span>%s</span></a></div> %s'), 
				get_topic_link($topic->topic_id), $icon_set_url.'/'.$image, ICON_WIDTH, ICON_HEIGHT, $tooltip, $tooltip, $label);
		} else {
			return sprintf(__('<div class="topic-icon-image"><a href="%s"><img src="%s" width="%s" height="%s" alt="%s" border="0"></a></div> %s'), 
				get_topic_link($topic->topic_id), $icon_set_url.'/'.$image, ICON_WIDTH, ICON_HEIGHT, $tooltip, $label);
		}
	}
	
	return $label;
}

function topic_icons_init( ) {
	remove_filter('bb_topic_labels', 'bb_closed_label', 10);
	remove_filter('bb_topic_labels', 'bb_sticky_label', 20);

	add_filter('bb_topic_labels', 'topic_icons_label', 11);

	add_action('bb_head', 'topic_icons_css');

	add_action('bb_admin_menu_generator', 'topic_icons_admin_page_add');
	add_action('bb_admin-header.php', 'topic_icons_admin_page_process');
	
	topic_icons_register_status_interpreter('default', new DefaultStatusInterpreter(BUSY_THRESHOLD));
	topic_icons_register_status_renderer('default', new DefaultStatusRenderer());
}

topic_icons_init();

?>
<?xml version="1.0" encoding="UTF-8"?>
<!-- generator="bbPress/1.0.2" -->
<rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom">
	<channel>
		<title>Digital Humanities Questions &#38; Answers &#187; Topic: Map or Directory of Digital Humanists?</title>
		<link>http://digitalhumanities.org/answers/topic/map-or-directory-of-digital-humanists</link>
		<description>Digital Humanities Questions &amp; Answers &#187; Topic: Map or Directory of Digital Humanists?</description>
		<language>en-US</language>
		<pubDate>Sun, 24 Mar 2019 17:08:44 +0000</pubDate>
		<generator>http://bbpress.org/?v=1.0.2</generator>
		<textInput>
			<title><![CDATA[Search]]></title>
			<description><![CDATA[Search all topics from these forums.]]></description>
			<name>q</name>
			<link>http://digitalhumanities.org/answers/search.php</link>
		</textInput>
		<atom:link href="http://digitalhumanities.org/answers/rss/topic/map-or-directory-of-digital-humanists" rel="self" type="application/rss+xml" />

		<item>
			 
				<title>katherineharris on "Map or Directory of Digital Humanists?"</title>
						<link>http://digitalhumanities.org/answers/topic/map-or-directory-of-digital-humanists#post-2383</link>
			<pubDate>Mon, 29 Feb 2016 17:25:41 +0000</pubDate>
			<dc:creator>katherineharris</dc:creator>
			<guid isPermaLink="false">2383@http://digitalhumanities.org/answers/</guid>
			<description>&#60;p&#62;&#60;em&#62;Replying to @Patrick Murray-John's &#60;a href=&#34;http://digitalhumanities.org/answers/topic/map-or-directory-of-digital-humanists#post-2382&#34;&#62;post&#60;/a&#62;:&#60;/em&#62;&#60;/p&#62;
&#60;p&#62;All of this began because I heard through live tweeting about an NEH-funded effort in San Diego to create a local consortium regarding digital pedagogy and DH. It's been in play for almost a year at a CSU (my university's system). I was incredibly overjoyed to see this happened at a CSU where DH Centers are rare due to funding and space limitations. Even in the CSUs there's no way to contact faculty at the other 22 campuses to see who's playing with DH. And, admittedly, I've expended lots and lots and lots of time trying to organize locally over the years. But, it's a time suck and my department doesn't give me professional credit for doing this kind of work. Glenn Worthey created a meet-up group for DH in the Bay Area, but it's fragmented (and again takes lots of time). Stanford has its LitLab and CESTA. There's a few faculty at other local institutions (and there are many in the Bay Area!) but I have no idea who unless I cold call departments. And then that doesn't necessarily inspire anything other than a &#34;hey, how's it going?&#34; We need a better way to make contact. If for anything, so we can collaborate locally and host events and avoid reinventing the wheel on projects. (I was just part of a California gathering of DHers; if I'd known about the San Diego lot, I would have strongly recommended them to be invited to the gathering as well!) &#60;/p&#62;
&#60;p&#62;So, if there's data already out there from Day of DH, can we go through it to create even an ugly listing of DHer locales?
&#60;/p&#62;</description>
		</item>
		<item>
			 
				<title>Patrick Murray-John on "Map or Directory of Digital Humanists?"</title>
						<link>http://digitalhumanities.org/answers/topic/map-or-directory-of-digital-humanists#post-2382</link>
			<pubDate>Mon, 29 Feb 2016 17:13:20 +0000</pubDate>
			<dc:creator>Patrick Murray-John</dc:creator>
			<guid isPermaLink="false">2382@http://digitalhumanities.org/answers/</guid>
			<description>&#60;p&#62;Yeah, that is a challenge that lots of different places have been trying to tackle in different ways, especially at a more local level. Examples of that are the &#60;a href='http://nycdh.org/'&#62;NYCDH site&#60;/a&#62;, &#60;a href='https://phillydh.org/'&#62;DH Philly&#60;/a&#62;, and &#60;a href='http://vadhconsortium.org/'&#62;Virgina DH Consortium&#60;/a&#62;. Those are basically attempts in other places to tackle the same problem, with varying degrees of success. Difficulty for all is finding the people who should join up in the first place, which is more at the heart of your question.&#60;/p&#62;
&#60;p&#62;That said, I'm more confident about the regional efforts to build a DH community than I am with an effort at a national or international listing by location. I suspect that there will be more word-of-mouth growth at that local scale to build up membership in such sites (both NYCDH and VA are using Commons In A Box, I think, so setup is pretty easy).&#60;/p&#62;
&#60;p&#62;If you're in the Santa Cruz neighborhood, I think some folks at UCSC have at least started talking about how to build up a group for that area.&#60;/p&#62;
&#60;p&#62;I haven't been especially active on it, so I don't know how helpful it might be, but there's also the &#60;a href='https://digitalhumanities.slack.com'&#62;DH Slack&#60;/a&#62;, where you might be able to ask and spot people in your neighborhood.
&#60;/p&#62;</description>
		</item>
		<item>
			 
				<title>katherineharris on "Map or Directory of Digital Humanists?"</title>
						<link>http://digitalhumanities.org/answers/topic/map-or-directory-of-digital-humanists#post-2381</link>
			<pubDate>Mon, 29 Feb 2016 15:19:45 +0000</pubDate>
			<dc:creator>katherineharris</dc:creator>
			<guid isPermaLink="false">2381@http://digitalhumanities.org/answers/</guid>
			<description>&#60;p&#62;&#60;em&#62;Replying to @Patrick Murray-John's &#60;a href=&#34;http://digitalhumanities.org/answers/topic/map-or-directory-of-digital-humanists#post-2380&#34;&#62;post&#60;/a&#62;:&#60;/em&#62;&#60;/p&#62;
&#60;p&#62;Good solutions and ones that I've used over the last decade, but California is a very, very big state. And waiting for planned events or infrastructure to be instituted isn't quite what I'm looking for. I've been at this DH thing for a few years, and I'm  interested in expanding my network of DHers beyond the seredipity meet n'greet or the pub phenomenon (discovering each other by accident). &#60;/p&#62;
&#60;p&#62;It would be terrific if we had a directory of some sort so we don't miss each other (and don't have to wait for yearly events such as Day of DH). Even DHCommons doesn't have a geographical sort to its list of collaborators. &#60;/p&#62;
&#60;p&#62;Anyone want to take this up or propose it to Day of DH organizers?
&#60;/p&#62;</description>
		</item>
		<item>
			 
				<title>Patrick Murray-John on "Map or Directory of Digital Humanists?"</title>
						<link>http://digitalhumanities.org/answers/topic/map-or-directory-of-digital-humanists#post-2380</link>
			<pubDate>Mon, 29 Feb 2016 13:12:36 +0000</pubDate>
			<dc:creator>Patrick Murray-John</dc:creator>
			<guid isPermaLink="false">2380@http://digitalhumanities.org/answers/</guid>
			<description>&#60;p&#62;Day of DH is a good bet for finding others. Also, keep an eye out for local THATCamps. They are a great way to make those face-to-face meetings.
&#60;/p&#62;</description>
		</item>
		<item>
			 
				<title>katherineharris on "Map or Directory of Digital Humanists?"</title>
						<link>http://digitalhumanities.org/answers/topic/map-or-directory-of-digital-humanists#post-2379</link>
			<pubDate>Sun, 28 Feb 2016 01:15:57 +0000</pubDate>
			<dc:creator>katherineharris</dc:creator>
			<guid isPermaLink="false">2379@http://digitalhumanities.org/answers/</guid>
			<description>&#60;p&#62;Has anyone ever created a directory or map of Digital Humanists? I ask because there are so many doing DH in California but I don't know where or how to find them. I follow lists on Twitter, keep updated on recent scholarship and writings, talk to many people, but still I hear about California DH events after the fact. &#60;/p&#62;
&#60;p&#62;Would really like to know if someone has taken this up based on the directory from DHNow or DHCommons or Day of DH. &#60;/p&#62;
&#60;p&#62;I bet if we knew there was someone down the street that we could get up to some interesting shenanigans in DH
&#60;/p&#62;</description>
		</item>

	</channel>
</rss>
